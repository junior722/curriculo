<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Currículo Completo</title>
    <!-- Inclui Tailwind CSS para estilização -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <!-- Inclui jsPDF para geração de PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- Inclui html2canvas para renderizar HTML em canvas (para PDF) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        /* Estilos para a pré-visualização */
        #previewContent {
            font-family: 'Inter', sans-serif;
            color: #333;
            line-height: 1.5;
            padding: 20px;
            box-sizing: border-box;
            background-color: white;
            min-height: 297mm; /* Altura de uma página A4 */
            width: 210mm; /* Largura de uma página A4 */
            margin: 0 auto;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            border-radius: 8px;
            overflow: hidden; /* Garante que o conteúdo não vaze */
        }

        #previewContent h1 {
            font-size: 1.8rem;
            font-weight: bold;
            color: #1a202c; /* Cor escura para títulos */
            text-align: center;
            margin-bottom: 10px;
        }

        #previewContent h2 {
            font-size: 1.4rem;
            font-weight: 600;
            color: #2c5282; /* Cor azul para subtítulos */
            border-bottom: 1px solid #cbd5e0;
            padding-bottom: 5px;
            margin-top: 20px;
            margin-bottom: 10px;
        }

        #previewContent p, #previewContent ul {
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        #previewContent ul {
            list-style-type: disc;
            margin-left: 20px;
        }

        #previewContent .contact-info {
            text-align: center;
            font-size: 0.85rem;
            color: #4a5568;
            margin-bottom: 15px;
        }

        #previewContent .section-item {
            margin-bottom: 15px;
        }

        #previewContent .section-item:last-child {
            margin-bottom: 0;
        }

        #previewContent .photo-container {
            text-align: center;
            margin-bottom: 20px;
        }

        #previewContent .photo-container img {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #e2e8f0;
        }
        .whatsapp-icon::before {
            content: ' ';
            display: inline-block;
            width: 16px;
            height: 16px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%2325D366"><path d="M12.04 2c-5.46 0-9.91 4.45-9.91 9.91 0 1.75.5 3.45 1.46 4.96L2 22l5.25-1.38c1.45.79 3.08 1.21 4.79 1.21 5.46 0 9.91-4.45 9.91-9.91S17.5 2 12.04 2zm.04 18.12c-1.48 0-2.93-.4-4.2-1.16l-.3-.18-3.12.82.83-3.04-.2-.31c-.82-1.27-1.26-2.75-1.26-4.27 0-4.54 3.7-8.24 8.24-8.24 2.2 0 4.27.86 5.82 2.41s2.41 3.62 2.41 5.82c0 4.54-3.7 8.24-8.24 8.24zm4.52-6.16c-.25-.12-.65-.32-.93-.45-.24-.12-.52-.01-.72.22s-.78.93-.95 1.12c-.17.19-.34.21-.63.08-.3-.14-1.26-.46-2.4-1.48-.88-.79-1.48-1.76-1.66-2.07-.18-.3-.02-.46.11-.6s.29-.32.42-.48c.14-.16.19-.3.29-.49s.05-.35-.02-.49c-.07-.14-.63-1.52-.87-2.07-.24-.52-.48-.45-.65-.46-.17-.01-.37-.01-.57-.01-.2 0-.52.07-.78.35-.26.29-.99.96-.99 2.33s1.01 2.7 1.15 2.9c.14.2 1.95 2.99 4.71 4.1c.67.29 1.2.46 1.62.59.6.19 1.13.16 1.56.1.48-.07 1.26-.51 1.44-.99.18-.48.18-.89.12-.99s-.22-.16-.47-.29z"/></svg>');
            background-size: contain;
            background-repeat: no-repeat;
            vertical-align: middle;
            margin-right: 4px;
        }
        /* Estilo para o spinner de carregamento */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #667eea; /* Cor do spinner */
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            vertical-align: middle;
            margin-left: 8px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 font-sans text-gray-800 antialiased p-4 sm:p-6 md:p-8">
    <div class="flex flex-col lg:flex-row gap-6 max-w-7xl mx-auto">
        <!-- Formulário de Preenchimento -->
        <div class="lg:w-1/2 bg-white p-6 sm:p-8 rounded-lg shadow-xl border border-gray-200">
            <h1 class="text-3xl sm:text-4xl font-bold text-center text-indigo-700 mb-6">Crie Seu Currículo</h1>
            <p class="text-center text-gray-600 mb-8">Preencha os campos abaixo para gerar seu currículo.</p>

            <form id="resumeForm" class="space-y-6">
                <!-- Seção de Dados Pessoais -->
                <details open class="bg-indigo-50 p-4 rounded-lg border border-indigo-200 shadow-sm">
                    <summary class="text-2xl font-semibold text-indigo-600 cursor-pointer">1. Dados Pessoais</summary>
                    <div class="pt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="name" class="block text-sm font-medium text-gray-700 mb-1">Nome Completo:</label>
                            <input type="text" id="name" class="w-full p-3 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 ease-in-out" placeholder="Seu nome" required oninput="updatePreview()">
                        </div>
                        <div>
                            <label for="dob" class="block text-sm font-medium text-gray-700 mb-1">Data de Nascimento:</label>
                            <input type="date" id="dob" class="w-full p-3 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 ease-in-out" onchange="calculateAgeAndPreview()">
                            <p id="ageDisplay" class="text-sm text-gray-600 mt-1"></p>
                        </div>
                        <div>
                            <label for="nationality" class="block text-sm font-medium text-gray-700 mb-1">Nacionalidade:</label>
                            <input type="text" id="nationality" class="w-full p-3 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 ease-in-out" placeholder="Brasileiro(a)" oninput="updatePreview()">
                        </div>
                        <div>
                            <label for="maritalStatus" class="block text-sm font-medium text-gray-700 mb-1">Estado Civil:</label>
                            <input type="text" id="maritalStatus" class="w-full p-3 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 ease-in-out" placeholder="Solteiro(a)" oninput="updatePreview()">
                        </div>
                        <div class="md:col-span-2 grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div>
                                <label for="addressStreet" class="block text-sm font-medium text-gray-700 mb-1">Rua:</label>
                                <input type="text" id="addressStreet" class="w-full p-3 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 ease-in-out" placeholder="Rua Exemplo" oninput="updatePreview()">
                            </div>
                            <div>
                                <label for="addressNumber" class="block text-sm font-medium text-gray-700 mb-1">Número:</label>
                                <input type="text" id="addressNumber" class="w-full p-3 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 ease-in-out" placeholder="123" oninput="updatePreview()">
                            </div>
                            <div>
                                <label for="addressNeighborhood" class="block text-sm font-medium text-gray-700 mb-1">Bairro:</label>
                                <input type="text" id="addressNeighborhood" class="w-full p-3 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 ease-in-out" placeholder="Bairro Exemplo" oninput="updatePreview()">
                            </div>
                            <div>
                                <label for="addressCEP" class="block text-sm font-medium text-gray-700 mb-1">CEP:</label>
                                <input type="text" id="addressCEP" class="w-full p-3 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 ease-in-out" placeholder="XXXXX-XXX" oninput="updatePreview()">
                            </div>
                            <div>
                                <label for="addressCity" class="block text-sm font-medium text-gray-700 mb-1">Cidade:</label>
                                <input type="text" id="addressCity" class="w-full p-3 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 ease-in-out" placeholder="Cidade Exemplo" oninput="updatePreview()">
                            </div>
                            <div>
                                <label for="addressUF" class="block text-sm font-medium text-gray-700 mb-1">UF:</label>
                                <select id="addressUF" class="w-full p-3 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 ease-in-out" onchange="updatePreview()">
                                    <option value="">Selecione</option>
                                    <option value="AC">AC</option><option value="AL">AL</option><option value="AP">AP</option><option value="AM">AM</option><option value="BA">BA</option><option value="CE">CE</option><option value="DF">DF</option><option value="ES">ES</option><option value="GO">GO</option><option value="MA">MA</option><option value="MT">MT</option><option value="MS">MS</option><option value="MG">MG</option><option value="PA">PA</option><option value="PB">PB</option><option value="PR">PR</option><option value="PE">PE</option><option value="PI">PI</option><option value="RJ">RJ</option><option value="RN">RN</option><option value="RS">RS</option><option value="RO">RO</option><option value="RR">RR</option><option value="SC">SC</option><option value="SP">SP</option><option value="SE">SE</option><option value="TO">TO</option>
                                </select>
                            </div>
                        </div>

                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Telefones:</label>
                            <div id="phoneContainer" class="space-y-2">
                                <!-- Modelo de telefone -->
                                <div class="phone-item flex items-center gap-2">
                                    <input type="tel" id="phone1" class="flex-grow p-3 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 ease-in-out" placeholder="(XX) XXXXX-XXXX" required oninput="updatePreview()">
                                    <input type="checkbox" id="whatsapp1" class="form-checkbox h-5 w-5 text-green-600 rounded" onchange="updatePreview()">
                                    <label for="whatsapp1" class="text-sm text-gray-700 flex items-center">
                                        <svg class="w-4 h-4 text-green-600 mr-1" fill="currentColor" viewBox="0 0 24 24"><path d="M12.04 2c-5.46 0-9.91 4.45-9.91 9.91 0 1.75.5 3.45 1.46 4.96L2 22l5.25-1.38c1.45.79 3.08 1.21 4.79 1.21 5.46 0 9.91-4.45 9.91-9.91S17.5 2 12.04 2zm.04 18.12c-1.48 0-2.93-.4-4.2-1.16l-.3-.18-3.12.82.83-3.04-.2-.31c-.82-1.27-1.26-2.75-1.26-4.27 0-4.54 3.7-8.24 8.24-8.24 2.2 0 4.27.86 5.82 2.41s2.41 3.62 2.41 5.82c0 4.54-3.7 8.24-8.24 8.24zm4.52-6.16c-.25-.12-.65-.32-.93-.45-.24-.12-.52-.01-.72.22s-.78.93-.95 1.12c-.17.19-.34.21-.63.08-.3-.14-1.26-.46-2.4-1.48-.88-.79-1.48-1.76-1.66-2.07-.18-.3-.02-.46.11-.6s.29-.32.42-.48c.14-.16.19-.3.29-.49s.05-.35-.02-.49c-.07-.14-.63-1.52-.87-2.07-.24-.52-.48-.45-.65-.46-.17-.01-.37-.01-.57-.01-.2 0-.52.07-.78.35-.26.29-.99.96-.99 2.33s1.01 2.7 1.15 2.9c.14.2 1.95 2.99 4.71 4.1c.67.29 1.2.46 1.62.59.6.19 1.13.16 1.56.1.48-.07 1.26-.51 1.44-.99.18-.48.18-.89.12-.99s-.22-.16-.47-.29z"/></svg>
                                        WhatsApp
                                    </label>
                                    <button type="button" class="remove-phone-btn px-2 py-1 bg-red-500 text-white rounded-md hover:bg-red-600 transition duration-150 ease-in-out text-sm">Remover</button>
                                </div>
                            </div>
                            <button type="button" id="addPhoneBtn" class="mt-2 px-4 py-2 bg-indigo-600 text-white font-semibold rounded-md hover:bg-indigo-700 transition duration-150 ease-in-out shadow-md">Adicionar Telefone</button>
                        </div>
                        <div>
                            <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email:</label>
                            <input type="email" id="email" class="w-full p-3 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 ease-in-out" placeholder="seu.email@exemplo.com" required oninput="updatePreview()">
                        </div>
                        <div>
                            <label for="portfolio" class="block text-sm font-medium text-gray-700 mb-1">Link do Portfólio (opcional):</label>
                            <input type="url" id="portfolio" class="w-full p-3 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 ease-in-out" placeholder="https://seu-portfolio.com" oninput="updatePreview()">
                        </div>
                        <div class="md:col-span-2">
                            <label for="photo" class="block text-sm font-medium text-gray-700 mb-1">Foto (opcional):</label>
                            <input type="file" id="photo" accept="image/*" class="w-full p-3 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 ease-in-out" onchange="handlePhotoUpload(event)">
                        </div>
                    </div>
                </details>

                <!-- Seção de Resumo Profissional -->
                <details open class="bg-blue-50 p-4 rounded-lg border border-blue-200 shadow-sm">
                    <summary class="text-2xl font-semibold text-blue-600 cursor-pointer">2. Resumo Profissional</summary>
                    <div class="pt-4">
                        <label for="summary" class="block text-sm font-medium text-gray-700 mb-1">Breve descrição sobre você e seus objetivos (máx. 500 caracteres):</label>
                        <textarea id="summary" rows="6" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out" placeholder="Ex: Profissional com 5 anos de experiência em marketing digital, buscando uma oportunidade para aplicar habilidades em SEO e mídias sociais..." maxlength="500" required oninput="updatePreview()"></textarea>
                        <button type="button" id="generateSummaryBtn" class="px-4 py-2 bg-purple-600 text-white font-semibold rounded-md hover:bg-purple-700 transition duration-150 ease-in-out shadow-md mt-2">Gerar Resumo Profissional ✨</button>
                        <span id="summaryLoading" class="hidden spinner"></span>
                    </div>
                </details>

                <!-- Seção de Experiência Profissional -->
                <details open class="bg-green-50 p-4 rounded-lg border border-green-200 shadow-sm">
                    <summary class="text-2xl font-semibold text-green-600 cursor-pointer">3. Experiência Profissional</summary>
                    <div id="experienceContainer" class="pt-4 space-y-4">
                        <!-- Modelo de experiência -->
                        <div class="experience-item p-3 border border-green-300 rounded-md bg-white">
                            <label for="jobTitle1" class="block text-sm font-medium text-gray-700 mb-1">Cargo:</label>
                            <input type="text" id="jobTitle1" class="w-full p-2 mb-2 border border-gray-300 rounded-md" placeholder="Ex: Analista de Marketing" required oninput="updatePreview()">

                            <label for="company1" class="block text-sm font-medium text-gray-700 mb-1">Empresa:</label>
                            <input type="text" id="company1" class="w-full p-2 mb-2 border border-gray-300 rounded-md" placeholder="Ex: Empresa ABC" required oninput="updatePreview()">

                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-2">
                                <div>
                                    <label for="startDate1" class="block text-sm font-medium text-gray-700 mb-1">Data de Início:</label>
                                    <input type="month" id="startDate1" class="w-full p-2 border border-gray-300 rounded-md" required onchange="updatePreview()">
                                </div>
                                <div>
                                    <label for="endDate1" class="block text-sm font-medium text-gray-700 mb-1">Data de Término (ou "Atual"):</label>
                                    <input type="month" id="endDate1" class="w-full p-2 border border-gray-300 rounded-md" onchange="updatePreview()">
                                </div>
                            </div>
                            <label for="responsibilities1" class="block text-sm font-medium text-gray-700 mb-1">Principais Atividades e Conquistas (use tópicos, máx. 500 caracteres - opcional):</label>
                            <textarea id="responsibilities1" rows="3" class="w-full p-2 border border-gray-300 rounded-md" placeholder="- Gerenciamento de campanhas de mídia social&#10;- Aumento de 20% no engajamento..." maxlength="500" oninput="updatePreview()"></textarea>
                            <div class="flex justify-end mt-2">
                                <button type="button" class="optimize-responsibilities-btn px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 transition duration-150 ease-in-out text-sm">Otimizar Descrição ✨</button>
                                <span class="responsibility-loading hidden spinner"></span>
                            </div>
                            <button type="button" class="remove-experience-btn mt-3 px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 transition duration-150 ease-in-out text-sm">Remover</button>
                        </div>
                    </div>
                    <button type="button" id="addExperienceBtn" class="mt-4 px-5 py-2 bg-green-600 text-white font-semibold rounded-md hover:bg-green-700 transition duration-150 ease-in-out shadow-md">Adicionar Experiência</button>
                </details>

                <!-- Seção de Formação Acadêmica -->
                <details open class="bg-yellow-50 p-4 rounded-lg border border-yellow-200 shadow-sm">
                    <summary class="text-2xl font-semibold text-yellow-600 cursor-pointer">4. Formação Acadêmica</summary>
                    <div id="educationContainer" class="pt-4 space-y-4">
                        <!-- Modelo de educação -->
                        <div class="education-item p-3 border border-yellow-300 rounded-md bg-white">
                            <label for="educationType1" class="block text-sm font-medium text-gray-700 mb-1">Tipo de Ensino:</label>
                            <select id="educationType1" class="w-full p-2 mb-2 border border-gray-300 rounded-md" required onchange="updatePreview()">
                                <option value="">Selecione o tipo de ensino</option>
                                <option value="Ensino Fundamental Incompleto">Ensino Fundamental Incompleto</option>
                                <option value="Ensino Fundamental Completo">Ensino Fundamental Completo</option>
                                <option value="Ensino Médio Incompleto">Ensino Médio Incompleto</option>
                                <option value="Ensino Médio Completo">Ensino Médio Completo</option>
                                <option value="Ensino Técnico Incompleto">Ensino Técnico Incompleto</option>
                                <option value="Ensino Técnico Completo">Ensino Técnico Completo</option>
                                <option value="Ensino Superior Incompleto">Ensino Superior Incompleto</option>
                                <option value="Ensino Superior Completo">Ensino Superior Completo</option>
                                <option value="Pós-Graduação Incompleta">Pós-Graduação Incompleta</option>
                                <option value="Pós-Graduação Completa">Pós-Graduação Completa</option>
                                <option value="Mestrado Incompleto">Mestrado Incompleto</option>
                                <option value="Mestrado Completo">Mestrado Completo</option>
                                <option value="Doutorado Incompleto">Doutorado Incompleto</option>
                                <option value="Doutorado Completo">Doutorado Completo</option>
                                <option value="Outro">Outro</option>
                            </select>

                            <label for="institution1" class="block text-sm font-medium text-gray-700 mb-1">Instituição (opcional):</label>
                            <input type="text" id="institution1" class="w-full p-2 mb-2 border border-gray-300 rounded-md" placeholder="Ex: Universidade Federal XYZ" oninput="updatePreview()">

                            <label for="degree1" class="block text-sm font-medium text-gray-700 mb-1">Curso/Grau (opcional):</label>
                            <input type="text" id="degree1" class="w-full p-2 mb-2 border border-gray-300 rounded-md" placeholder="Ex: Bacharelado em Ciência da Computação" oninput="updatePreview()">

                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-2">
                                <div>
                                    <label for="eduStartDate1" class="block text-sm font-medium text-gray-700 mb-1">Data de Início (opcional):</label>
                                    <input type="month" id="eduStartDate1" class="w-full p-2 border border-gray-300 rounded-md" onchange="updatePreview()">
                                </div>
                                <div>
                                    <label for="eduEndDate1" class="block text-sm font-medium text-gray-700 mb-1">Data de Término (ou "Atual" - opcional):</label>
                                    <input type="month" id="eduEndDate1" class="w-full p-2 border border-gray-300 rounded-md" onchange="updatePreview()">
                                </div>
                            </div>
                            <label for="eduObservations1" class="block text-sm font-medium text-gray-700 mb-1">Observações (ex: TCC, intercâmbio, máx. 200 caracteres - opcional):</label>
                            <textarea id="eduObservations1" rows="2" class="w-full p-2 border border-gray-300 rounded-md" placeholder="Ex: TCC sobre Inteligência Artificial" maxlength="200" oninput="updatePreview()"></textarea>
                            <button type="button" class="remove-education-btn mt-3 px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 transition duration-150 ease-in-out text-sm">Remover</button>
                        </div>
                    </div>
                    <button type="button" id="addEducationBtn" class="mt-4 px-5 py-2 bg-yellow-600 text-white font-semibold rounded-md hover:bg-yellow-700 transition duration-150 ease-in-out shadow-md">Adicionar Formação</button>
                </details>

                <!-- Seção de Certificações e Cursos -->
                <details class="bg-orange-50 p-4 rounded-lg border border-orange-200 shadow-sm">
                    <summary class="text-2xl font-semibold text-orange-600 cursor-pointer">5. Certificações e Cursos (Opcional)</summary>
                    <div id="certificationsContainer" class="pt-4 space-y-4">
                        <!-- Modelo de certificação -->
                        <div class="certification-item p-3 border border-orange-300 rounded-md bg-white">
                            <label for="certName1" class="block text-sm font-medium text-gray-700 mb-1">Nome do Curso/Certificação:</label>
                            <input type="text" id="certName1" class="w-full p-2 mb-2 border border-gray-300 rounded-md" placeholder="Ex: Certificação Scrum Master" oninput="updatePreview()">

                            <label for="certInstitution1" class="block text-sm font-medium text-gray-700 mb-1">Instituição:</label>
                            <input type="text" id="certInstitution1" class="w-full p-2 mb-2 border border-gray-300 rounded-md" placeholder="Ex: Scrum.org" oninput="updatePreview()">

                            <label for="certYear1" class="block text-sm font-medium text-gray-700 mb-1">Ano de Conclusão:</label>
                            <input type="number" id="certYear1" class="w-full p-2 mb-2 border border-gray-300 rounded-md" placeholder="Ex: 2023" min="1900" max="2100" oninput="updatePreview()">
                            <button type="button" class="remove-certification-btn mt-3 px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 transition duration-150 ease-in-out text-sm">Remover</button>
                        </div>
                    </div>
                    <button type="button" id="addCertificationBtn" class="mt-4 px-5 py-2 bg-orange-600 text-white font-semibold rounded-md hover:bg-orange-700 transition duration-150 ease-in-out shadow-md">Adicionar Certificação/Curso</button>
                </details>

                <!-- Seção de Habilidades Técnicas e Soft Skills -->
                <details class="bg-purple-50 p-4 rounded-lg border border-purple-200 shadow-sm">
                    <summary class="text-2xl font-semibold text-purple-600 cursor-pointer">6. Habilidades (Opcional)</summary>
                    <div class="pt-4 space-y-4">
                        <div>
                            <label for="hardSkills" class="block text-sm font-medium text-gray-700 mb-1">Hard Skills (Habilidades Técnicas - separadas por vírgula, máx. 500 caracteres):</label>
                            <textarea id="hardSkills" rows="4" class="w-full p-3 border border-gray-300 rounded-md focus:ring-purple-500 focus:border-purple-500 transition duration-150 ease-in-out" placeholder="Ex: Python, JavaScript, SQL, Docker, AWS, React" maxlength="500" oninput="updatePreview()"></textarea>
                        </div>
                        <div>
                            <label for="softSkills" class="block text-sm font-medium text-gray-700 mb-1">Soft Skills (Habilidades Comportamentais - separadas por vírgula, máx. 500 caracteres):</label>
                            <textarea id="softSkills" rows="4" class="w-full p-3 border border-gray-300 rounded-md focus:ring-purple-500 focus:border-purple-500 transition duration-150 ease-in-out" placeholder="Ex: Comunicação, Liderança, Resolução de Problemas, Trabalho em Equipe" maxlength="500" oninput="updatePreview()"></textarea>
                        </div>
                    </div>
                </details>

                <!-- Seção de Idiomas -->
                <details class="bg-cyan-50 p-4 rounded-lg border border-cyan-200 shadow-sm">
                    <summary class="text-2xl font-semibold text-cyan-600 cursor-pointer">7. Idiomas</summary>
                    <div id="languagesContainer" class="pt-4 space-y-4">
                        <!-- Modelo de idioma -->
                        <div class="language-item p-3 border border-cyan-300 rounded-md bg-white">
                            <label for="langName1" class="block text-sm font-medium text-gray-700 mb-1">Nome do Idioma:</label>
                            <input type="text" id="langName1" class="w-full p-2 mb-2 border border-gray-300 rounded-md" placeholder="Ex: Inglês" oninput="updatePreview()">

                            <label for="langFluency1" class="block text-sm font-medium text-gray-700 mb-1">Nível de Fluência:</label>
                            <select id="langFluency1" class="w-full p-2 mb-2 border border-gray-300 rounded-md" onchange="updatePreview()">
                                <option value="">Selecione a fluência</option>
                                <option value="Básico">Básico</option>
                                <option value="Intermediário">Intermediário</option>
                                <option value="Avançado">Avançado</option>
                                <option value="Fluente">Fluente</option>
                                <option value="Nativo">Nativo</option>
                            </select>
                            <button type="button" class="remove-language-btn mt-3 px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 transition duration-150 ease-in-out text-sm">Remover</button>
                        </div>
                    </div>
                    <button type="button" id="addLanguageBtn" class="mt-4 px-5 py-2 bg-cyan-600 text-white font-semibold rounded-md hover:bg-cyan-700 transition duration-150 ease-in-out shadow-md">Adicionar Idioma</button>
                </details>

                <!-- Seção de Projetos e Portfólio -->
                <details class="bg-pink-50 p-4 rounded-lg border border-pink-200 shadow-sm">
                    <summary class="text-2xl font-semibold text-pink-600 cursor-pointer">8. Projetos e Portfólio (Opcional)</summary>
                    <div id="projectsContainer" class="pt-4 space-y-4">
                        <!-- Modelo de projeto -->
                        <div class="project-item p-3 border border-pink-300 rounded-md bg-white">
                            <label for="projectName1" class="block text-sm font-medium text-gray-700 mb-1">Nome do Projeto:</label>
                            <input type="text" id="projectName1" class="w-full p-2 mb-2 border border-gray-300 rounded-md" placeholder="Ex: E-commerce de Roupas" oninput="updatePreview()">

                            <label for="projectLink1" class="block text-sm font-medium text-gray-700 mb-1">Link (opcional):</label>
                            <input type="url" id="projectLink1" class="w-full p-2 mb-2 border border-gray-300 rounded-md" placeholder="https://link-do-projeto.com" oninput="updatePreview()">

                            <label for="projectDescription1" class="block text-sm font-medium text-gray-700 mb-1">Descrição (máx. 300 caracteres):</label>
                            <textarea id="projectDescription1" rows="3" class="w-full p-2 border border-gray-300 rounded-md" placeholder="Ex: Desenvolvimento de plataforma e-commerce utilizando React e Node.js." maxlength="300" oninput="updatePreview()"></textarea>
                            <button type="button" class="remove-project-btn mt-3 px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 transition duration-150 ease-in-out text-sm">Remover</button>
                        </div>
                    </div>
                    <button type="button" id="addProjectBtn" class="mt-4 px-5 py-2 bg-pink-600 text-white font-semibold rounded-md hover:bg-pink-700 transition duration-150 ease-in-out shadow-md">Adicionar Projeto</button>
                </details>

                <!-- Seção de Referências -->
                <details class="bg-gray-200 p-4 rounded-lg border border-gray-300 shadow-sm">
                    <summary class="text-2xl font-semibold text-gray-700 cursor-pointer">9. Referências (Opcional)</summary>
                    <div id="referencesContainer" class="pt-4 space-y-4">
                        <!-- Modelo de referência -->
                        <div class="reference-item p-3 border border-gray-400 rounded-md bg-white">
                            <label for="refName1" class="block text-sm font-medium text-gray-700 mb-1">Nome:</label>
                            <input type="text" id="refName1" class="w-full p-2 mb-2 border border-gray-300 rounded-md" placeholder="Ex: João Silva" oninput="updatePreview()">

                            <label for="refPosition1" class="block text-sm font-medium text-gray-700 mb-1">Cargo:</label>
                            <input type="text" id="refPosition1" class="w-full p-2 mb-2 border border-gray-300 rounded-md" placeholder="Ex: Gerente de RH" oninput="updatePreview()">

                            <label for="refContact1" class="block text-sm font-medium text-gray-700 mb-1">Contato (Email/Telefone):</label>
                            <input type="text" id="refContact1" class="w-full p-2 mb-2 border border-gray-300 rounded-md" placeholder="Ex: joao.silva@empresa.com ou (XX) XXXXX-XXXX" oninput="updatePreview()">
                            <button type="button" class="remove-reference-btn mt-3 px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 transition duration-150 ease-in-out text-sm">Remover</button>
                        </div>
                    </div>
                    <button type="button" id="addReferenceBtn" class="mt-4 px-5 py-2 bg-gray-600 text-white font-semibold rounded-md hover:bg-gray-700 transition duration-150 ease-in-out shadow-md">Adicionar Referência</button>
                </details>

                <button type="submit" class="w-full py-3 bg-indigo-600 text-white font-bold rounded-md hover:bg-indigo-700 transition duration-200 ease-in-out shadow-lg">Gerar Currículo</button>
            </form>

            <div id="actions" class="mt-8 pt-6 border-t border-gray-200 hidden">
                <h2 class="text-2xl font-semibold text-gray-700 mb-4 text-center">Seu currículo está pronto!</h2>
                <div class="flex flex-col sm:flex-row justify-center gap-4">
                    <button id="downloadPdfBtn" class="flex-1 px-6 py-3 bg-blue-600 text-white font-bold rounded-md hover:bg-blue-700 transition duration-200 ease-in-out shadow-md">
                        Baixar Currículo (PDF)
                    </button>
                    <button id="sendWhatsappBtn" class="flex-1 px-6 py-3 bg-green-500 text-white font-bold rounded-md hover:bg-green-600 transition duration-200 ease-in-out shadow-md">
                        Enviar para o WhatsApp
                    </button>
                </div>
                <p class="text-center text-sm text-gray-500 mt-4">
                    Ao clicar em "Enviar para o WhatsApp", você será direcionado para o aplicativo. Lembre-se de anexar o arquivo PDF que você baixou.
                </p>
            </div>

            <!-- Modal para o número do WhatsApp -->
            <div id="whatsappModal" class="fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center hidden z-50">
                <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-sm">
                    <h3 class="text-xl font-semibold mb-4">Seu número de WhatsApp</h3>
                    <p class="text-gray-700 mb-4">Por favor, insira o número de WhatsApp (com DDD) para o qual você deseja enviar o currículo.</p>
                    <input type="tel" id="whatsappNumberInput" class="w-full p-3 border border-gray-300 rounded-md mb-4" placeholder="Ex: 5511987654321" required>
                    <div class="flex justify-end space-x-3">
                        <button id="cancelWhatsappBtn" class="px-4 py-2 bg-gray-300 text-gray-800 rounded-md hover:bg-gray-400">Cancelar</button>
                        <button id="confirmWhatsappBtn" class="px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600">Confirmar</button>
                    </div>
                </div>
            </div>

            <!-- Modal de aviso/erro -->
            <div id="messageModal" class="fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center hidden z-50">
                <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-sm">
                    <h3 id="messageModalTitle" class="text-xl font-semibold mb-4 text-red-600"></h3>
                    <p id="messageModalContent" class="text-gray-700 mb-4"></p>
                    <div class="flex justify-end">
                        <button id="closeMessageModalBtn" class="px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600">Ok</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pré-visualização do Currículo -->
        <div class="lg:w-1/2 bg-gray-200 p-4 rounded-lg shadow-xl border border-gray-300 sticky top-4 h-fit">
            <h2 class="text-2xl font-bold text-center text-gray-700 mb-4">Pré-visualização do Currículo</h2>
            <div id="previewContent" class="bg-white rounded-md overflow-y-auto max-h-[calc(100vh-100px)]">
                <!-- Conteúdo do currículo será renderizado aqui -->
                <p class="text-center text-gray-500 mt-20">Preencha o formulário para ver a pré-visualização do seu currículo.</p>
            </div>
        </div>
    </div>

    <script>
        const { jsPDF } = window.jspdf;
        let generatedPdfBlob = null;
        let photoDataUrl = ''; // Para armazenar a foto em base64

        // Função genérica para adicionar um novo item a uma seção
        function addItem(containerId, itemTemplate, removeBtnClass, countVar, addListenersFn) {
            window[countVar]++;
            const container = document.getElementById(containerId);
            const newItem = document.createElement('div');
            newItem.classList.add(itemTemplate.className, 'p-3', 'border', itemTemplate.borderColor, 'rounded-md', 'bg-white');
            newItem.innerHTML = itemTemplate.html(window[countVar]);
            container.appendChild(newItem);
            addListenersFn(); // Re-adiciona listeners para todos os botões de remover e inputs
            updatePreview(); // Atualiza a pré-visualização
        }

        // Função genérica para remover um item de uma seção
        function addRemoveListeners(removeBtnClass, containerId) {
            document.querySelectorAll(`.${removeBtnClass}`).forEach(button => {
                button.onclick = (event) => {
                    event.target.closest(`.${removeBtnClass.replace('remove-', '').replace('-btn', '-item')}`).remove();
                    updatePreview(); // Atualiza a pré-visualização após remover
                };
            });
            // Adiciona listeners de input/change para os novos campos
            document.querySelectorAll(`#${containerId} input, #${containerId} textarea, #${containerId} select`).forEach(input => {
                input.oninput = updatePreview;
                input.onchange = updatePreview;
            });

            // Adiciona listeners para os botões de otimização de responsabilidades
            if (containerId === 'experienceContainer') {
                document.querySelectorAll('.optimize-responsibilities-btn').forEach(button => {
                    button.onclick = (event) => optimizeResponsibilities(event.target);
                });
            }
        }

        // Contadores para itens dinâmicos
        let phoneCount = 1;
        let experienceCount = 1;
        let educationCount = 1;
        let certificationCount = 1;
        let languageCount = 1;
        let projectCount = 1;
        let referenceCount = 1;

        // Templates para os novos itens dinâmicos
        const phoneTemplate = {
            className: 'phone-item',
            borderColor: 'border-gray-300', // Não usado diretamente aqui, mas para consistência
            html: (count) => `
                <input type="tel" id="phone${count}" class="flex-grow p-3 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 ease-in-out" placeholder="(XX) XXXXX-XXXX" required oninput="updatePreview()">
                <input type="checkbox" id="whatsapp${count}" class="form-checkbox h-5 w-5 text-green-600 rounded" onchange="updatePreview()">
                <label for="whatsapp${count}" class="text-sm text-gray-700 flex items-center">
                    <svg class="w-4 h-4 text-green-600 mr-1" fill="currentColor" viewBox="0 0 24 24"><path d="M12.04 2c-5.46 0-9.91 4.45-9.91 9.91 0 1.75.5 3.45 1.46 4.96L2 22l5.25-1.38c1.45.79 3.08 1.21 4.79 1.21 5.46 0 9.91-4.45 9.91-9.91S17.5 2 12.04 2zm.04 18.12c-1.48 0-2.93-.4-4.2-1.16l-.3-.18-3.12.82.83-3.04-.2-.31c-.82-1.27-1.26-2.75-1.26-4.27 0-4.54 3.7-8.24 8.24-8.24 2.2 0 4.27.86 5.82 2.41s2.41 3.62 2.41 5.82c0 4.54-3.7 8.24-8.24 8.24zm4.52-6.16c-.25-.12-.65-.32-.93-.45-.24-.12-.52-.01-.72.22s-.78.93-.95 1.12c-.17.19-.34.21-.63.08-.3-.14-1.26-.46-2.4-1.48-.88-.79-1.48-1.76-1.66-2.07-.18-.3-.02-.46.11-.6s.29-.32.42-.48c.14-.16.19-.3.29-.49s.05-.35-.02-.49c-.07-.14-.63-1.52-.87-2.07-.24-.52-.48-.45-.65-.46-.17-.01-.37-.01-.57-.01-.2 0-.52.07-.78.35-.26.29-.99.96-.99 2.33s1.01 2.7 1.15 2.9c.14.2 1.95 2.99 4.71 4.1c.67.29 1.2.46 1.62.59.6.19 1.13.16 1.56.1.48-.07 1.26-.51 1.44-.99.18-.48.18-.89.12-.99s-.22-.16-.47-.29z"/></svg>
                    WhatsApp
                </label>
                <button type="button" class="remove-phone-btn px-2 py-1 bg-red-500 text-white rounded-md hover:bg-red-600 transition duration-150 ease-in-out text-sm">Remover</button>
            `
        };

        const experienceTemplate = {
            className: 'experience-item',
            borderColor: 'border-green-300',
            html: (count) => `
                <label for="jobTitle${count}" class="block text-sm font-medium text-gray-700 mb-1">Cargo:</label>
                <input type="text" id="jobTitle${count}" class="w-full p-2 mb-2 border border-gray-300 rounded-md" placeholder="Ex: Analista de Marketing" required oninput="updatePreview()">

                <label for="company${count}" class="block text-sm font-medium text-gray-700 mb-1">Empresa:</label>
                <input type="text" id="company${count}" class="w-full p-2 mb-2 border border-gray-300 rounded-md" placeholder="Ex: Empresa ABC" required oninput="updatePreview()">

                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-2">
                    <div>
                        <label for="startDate${count}" class="block text-sm font-medium text-gray-700 mb-1">Data de Início:</label>
                        <input type="month" id="startDate${count}" class="w-full p-2 border border-gray-300 rounded-md" required onchange="updatePreview()">
                    </div>
                    <div>
                        <label for="endDate${count}" class="block text-sm font-medium text-gray-700 mb-1">Data de Término (ou "Atual"):</label>
                        <input type="month" id="endDate${count}" class="w-full p-2 border border-gray-300 rounded-md" onchange="updatePreview()">
                    </div>
                </div>
                <label for="responsibilities${count}" class="block text-sm font-medium text-gray-700 mb-1">Principais Atividades e Conquistas (use tópicos, máx. 500 caracteres - opcional):</label>
                <textarea id="responsibilities${count}" rows="3" class="w-full p-2 border border-gray-300 rounded-md" placeholder="- Gerenciamento de campanhas de mídia social&#10;- Aumento de 20% no engajamento..." maxlength="500" oninput="updatePreview()"></textarea>
                <div class="flex justify-end mt-2">
                    <button type="button" class="optimize-responsibilities-btn px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 transition duration-150 ease-in-out text-sm">Otimizar Descrição ✨</button>
                    <span class="responsibility-loading hidden spinner"></span>
                </div>
                <button type="button" class="remove-experience-btn mt-3 px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 transition duration-150 ease-in-out text-sm">Remover</button>
            `
        };

        const educationTemplate = {
            className: 'education-item',
            borderColor: 'border-yellow-300',
            html: (count) => `
                <label for="educationType${count}" class="block text-sm font-medium text-gray-700 mb-1">Tipo de Ensino:</label>
                <select id="educationType${count}" class="w-full p-2 mb-2 border border-gray-300 rounded-md" required onchange="updatePreview()">
                    <option value="">Selecione o tipo de ensino</option>
                    <option value="Ensino Fundamental Incompleto">Ensino Fundamental Incompleto</option>
                    <option value="Ensino Fundamental Completo">Ensino Fundamental Completo</option>
                    <option value="Ensino Médio Incompleto">Ensino Médio Incompleto</option>
                    <option value="Ensino Médio Completo">Ensino Médio Completo</option>
                    <option value="Ensino Técnico Incompleto">Ensino Técnico Incompleto</option>
                    <option value="Ensino Técnico Completo">Ensino Técnico Completo</option>
                    <option value="Ensino Superior Incompleto">Ensino Superior Incompleto</option>
                    <option value="Ensino Superior Completo">Ensino Superior Completo</option>
                    <option value="Pós-Graduação Incompleta">Pós-Graduação Incompleta</option>
                    <option value="Pós-Graduação Completa">Pós-Graduação Completa</option>
                    <option value="Mestrado Incompleto">Mestrado Incompleto</option>
                    <option value="Mestrado Completo">Mestrado Completo</option>
                    <option value="Doutorado Incompleto">Doutorado Incompleto</option>
                    <option value="Doutorado Completo">Doutorado Completo</option>
                    <option value="Outro">Outro</option>
                </select>

                <label for="institution${count}" class="block text-sm font-medium text-gray-700 mb-1">Instituição (opcional):</label>
                <input type="text" id="institution${count}" class="w-full p-2 mb-2 border border-gray-300 rounded-md" placeholder="Ex: Universidade Federal XYZ" oninput="updatePreview()">

                <label for="degree${count}" class="block text-sm font-medium text-gray-700 mb-1">Curso/Grau (opcional):</label>
                <input type="text" id="degree${count}" class="w-full p-2 mb-2 border border-gray-300 rounded-md" placeholder="Ex: Bacharelado em Ciência da Computação" oninput="updatePreview()">

                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-2">
                    <div>
                        <label for="eduStartDate${count}" class="block text-sm font-medium text-gray-700 mb-1">Data de Início (opcional):</label>
                        <input type="month" id="eduStartDate${count}" class="w-full p-2 border border-gray-300 rounded-md" onchange="updatePreview()">
                    </div>
                    <div>
                        <label for="eduEndDate${count}" class="block text-sm font-medium text-gray-700 mb-1">Data de Término (ou "Atual" - opcional):</label>
                        <input type="month" id="eduEndDate${count}" class="w-full p-2 border border-gray-300 rounded-md" onchange="updatePreview()">
                    </div>
                </div>
                <label for="eduObservations${count}" class="block text-sm font-medium text-gray-700 mb-1">Observações (ex: TCC, intercâmbio, máx. 200 caracteres - opcional):</label>
                <textarea id="eduObservations${count}" rows="2" class="w-full p-2 border border-gray-300 rounded-md" placeholder="Ex: TCC sobre Inteligência Artificial" maxlength="200" oninput="updatePreview()"></textarea>
                <button type="button" class="remove-education-btn mt-3 px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 transition duration-150 ease-in-out text-sm">Remover</button>
            `
        };

        const certificationTemplate = {
            className: 'certification-item',
            borderColor: 'border-orange-300',
            html: (count) => `
                <label for="certName${count}" class="block text-sm font-medium text-gray-700 mb-1">Nome do Curso/Certificação:</label>
                <input type="text" id="certName${count}" class="w-full p-2 mb-2 border border-gray-300 rounded-md" placeholder="Ex: Certificação Scrum Master" oninput="updatePreview()">

                <label for="certInstitution${count}" class="block text-sm font-medium text-gray-700 mb-1">Instituição:</label>
                <input type="text" id="certInstitution${count}" class="w-full p-2 mb-2 border border-gray-300 rounded-md" placeholder="Ex: Scrum.org" oninput="updatePreview()">

                <label for="certYear${count}" class="block text-sm font-medium text-gray-700 mb-1">Ano de Conclusão:</label>
                <input type="number" id="certYear${count}" class="w-full p-2 mb-2 border border-gray-300 rounded-md" placeholder="Ex: 2023" min="1900" max="2100" oninput="updatePreview()">
                <button type="button" class="remove-certification-btn mt-3 px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 transition duration-150 ease-in-out text-sm">Remover</button>
            `
        };

        const languageTemplate = {
            className: 'language-item',
            borderColor: 'border-cyan-300',
            html: (count) => `
                <label for="langName${count}" class="block text-sm font-medium text-gray-700 mb-1">Nome do Idioma:</label>
                <input type="text" id="langName${count}" class="w-full p-2 mb-2 border border-gray-300 rounded-md" placeholder="Ex: Inglês" oninput="updatePreview()">

                <label for="langFluency${count}" class="block text-sm font-medium text-gray-700 mb-1">Nível de Fluência:</label>
                <select id="langFluency${count}" class="w-full p-2 mb-2 border border-gray-300 rounded-md" onchange="updatePreview()">
                    <option value="">Selecione a fluência</option>
                    <option value="Básico">Básico</option>
                    <option value="Intermediário">Intermediário</option>
                    <option value="Avançado">Avançado</option>
                    <option value="Fluente">Fluente</option>
                    <option value="Nativo">Nativo</option>
                </select>
                <button type="button" class="remove-language-btn mt-3 px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 transition duration-150 ease-in-out text-sm">Remover</button>
            `
        };

        const projectTemplate = {
            className: 'project-item',
            borderColor: 'border-pink-300',
            html: (count) => `
                <label for="projectName${count}" class="block text-sm font-medium text-gray-700 mb-1">Nome do Projeto:</label>
                <input type="text" id="projectName${count}" class="w-full p-2 mb-2 border border-gray-300 rounded-md" placeholder="Ex: E-commerce de Roupas" oninput="updatePreview()">

                <label for="projectLink${count}" class="block text-sm font-medium text-gray-700 mb-1">Link (opcional):</label>
                <input type="url" id="projectLink${count}" class="w-full p-2 mb-2 border border-gray-300 rounded-md" placeholder="https://link-do-projeto.com" oninput="updatePreview()">

                <label for="projectDescription${count}" class="block text-sm font-medium text-gray-700 mb-1">Descrição (máx. 300 caracteres):</label>
                <textarea id="projectDescription${count}" rows="3" class="w-full p-2 border border-gray-300 rounded-md" placeholder="Ex: Desenvolvimento de plataforma e-commerce utilizando React e Node.js." maxlength="300" oninput="updatePreview()"></textarea>
                <button type="button" class="remove-project-btn mt-3 px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 transition duration-150 ease-in-out text-sm">Remover</button>
            `
        };

        const referenceTemplate = {
            className: 'reference-item',
            borderColor: 'border-gray-400',
            html: (count) => `
                <label for="refName${count}" class="block text-sm font-medium text-gray-700 mb-1">Nome:</label>
                <input type="text" id="refName${count}" class="w-full p-2 mb-2 border border-gray-300 rounded-md" placeholder="Ex: João Silva" oninput="updatePreview()">

                <label for="refPosition${count}" class="block text-sm font-medium text-gray-700 mb-1">Cargo:</label>
                <input type="text" id="refPosition${count}" class="w-full p-2 mb-2 border border-gray-300 rounded-md" placeholder="Ex: Gerente de RH" oninput="updatePreview()">

                <label for="refContact${count}" class="block text-sm font-medium text-gray-700 mb-1">Contato (Email/Telefone):</label>
                <input type="text" id="refContact${count}" class="w-full p-2 mb-2 border border-gray-300 rounded-md" placeholder="Ex: joao.silva@empresa.com ou (XX) XXXXX-XXXX" oninput="updatePreview()">
                <button type="button" class="remove-reference-btn mt-3 px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 transition duration-150 ease-in-out text-sm">Remover</button>
            `
        };


        // Adiciona listeners para os botões "Adicionar"
        document.getElementById('addPhoneBtn').addEventListener('click', () => addItem('phoneContainer', phoneTemplate, 'remove-phone-btn', 'phoneCount', () => addRemoveListeners('remove-phone-btn', 'phoneContainer')));
        document.getElementById('addExperienceBtn').addEventListener('click', () => addItem('experienceContainer', experienceTemplate, 'remove-experience-btn', 'experienceCount', () => addRemoveListeners('remove-experience-btn', 'experienceContainer')));
        document.getElementById('addEducationBtn').addEventListener('click', () => addItem('educationContainer', educationTemplate, 'remove-education-btn', 'educationCount', () => addRemoveListeners('remove-education-btn', 'educationContainer')));
        document.getElementById('addCertificationBtn').addEventListener('click', () => addItem('certificationsContainer', certificationTemplate, 'remove-certification-btn', 'certificationCount', () => addRemoveListeners('remove-certification-btn', 'certificationsContainer')));
        document.getElementById('addLanguageBtn').addEventListener('click', () => addItem('languagesContainer', languageTemplate, 'remove-language-btn', 'languageCount', () => addRemoveListeners('remove-language-btn', 'languagesContainer')));
        document.getElementById('addProjectBtn').addEventListener('click', () => addItem('projectsContainer', projectTemplate, 'remove-project-btn', 'projectCount', () => addRemoveListeners('remove-project-btn', 'projectsContainer')));
        document.getElementById('addReferenceBtn').addEventListener('click', () => addItem('referencesContainer', referenceTemplate, 'remove-reference-btn', 'referenceCount', () => addRemoveListeners('remove-reference-btn', 'referencesContainer')));

        // Adiciona listeners iniciais para os itens existentes
        addRemoveListeners('remove-phone-btn', 'phoneContainer');
        addRemoveListeners('remove-experience-btn', 'experienceContainer');
        addRemoveListeners('remove-education-btn', 'educationContainer');
        addRemoveListeners('remove-certification-btn', 'certificationsContainer');
        addRemoveListeners('remove-language-btn', 'languagesContainer');
        addRemoveListeners('remove-project-btn', 'projectsContainer');
        addRemoveListeners('remove-reference-btn', 'referencesContainer');


        // Função para exibir o modal de mensagem
        function showMessageModal(title, content, isError = false) {
            const modal = document.getElementById('messageModal');
            document.getElementById('messageModalTitle').textContent = title;
            document.getElementById('messageModalContent').textContent = content;
            document.getElementById('messageModalTitle').classList.toggle('text-red-600', isError);
            document.getElementById('messageModalTitle').classList.toggle('text-green-600', !isError);
            modal.classList.remove('hidden');
        }

        // Event listener para fechar o modal de mensagem
        document.getElementById('closeMessageModalBtn').addEventListener('click', () => {
            document.getElementById('messageModal').classList.add('hidden');
        });

        // Função para lidar com o upload da foto
        function handlePhotoUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    photoDataUrl = e.target.result;
                    updatePreview();
                };
                reader.readAsDataURL(file);
            } else {
                photoDataUrl = '';
                updatePreview();
            }
        }

        // Função para calcular idade
        function calculateAge(dobString) {
            if (!dobString) return '';
            const birthDate = new Date(dobString);
            const today = new Date();
            let age = today.getFullYear() - birthDate.getFullYear();
            const m = today.getMonth() - birthDate.getMonth();
            if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
                age--;
            }
            return age;
        }

        // Função para calcular idade e atualizar preview
        function calculateAgeAndPreview() {
            const dob = document.getElementById('dob').value;
            const ageDisplay = document.getElementById('ageDisplay');
            if (dob) {
                const age = calculateAge(dob);
                ageDisplay.textContent = `Idade: ${age} anos`;
            } else {
                ageDisplay.textContent = '';
            }
            updatePreview();
        }

        // Função para formatar a data de nascimento para exibição (DD/MM/AAAA)
        function formatDisplayDate(dateString) {
            if (!dateString) return '';
            const [year, month, day] = dateString.split('-');
            return `${day}/${month}/${year}`;
        }

        // Função para chamar a API Gemini
        async function callGeminiAPI(prompt, loadingElement, targetElement) {
            loadingElement.classList.remove('hidden');
            targetElement.disabled = true; // Desabilita o campo enquanto carrega

            try {
                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                const payload = { contents: chatHistory };
                const apiKey = ""; // Deixe como está, a chave será fornecida em tempo de execução
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    targetElement.value = text;
                    updatePreview(); // Atualiza a pré-visualização com o novo texto
                } else {
                    showMessageModal('Erro da API', 'Não foi possível gerar a resposta. Tente novamente.', true);
                    console.error('Estrutura de resposta inesperada:', result);
                }
            } catch (error) {
                showMessageModal('Erro de Conexão', 'Não foi possível conectar à API. Verifique sua conexão ou tente mais tarde.', true);
                console.error('Erro ao chamar a API Gemini:', error);
            } finally {
                loadingElement.classList.add('hidden');
                targetElement.disabled = false; // Habilita o campo novamente
            }
        }

        // Função para gerar o resumo profissional
        document.getElementById('generateSummaryBtn').addEventListener('click', async () => {
            const name = document.getElementById('name').value;
            const skills = document.getElementById('hardSkills').value + ', ' + document.getElementById('softSkills').value;
            let mainExperience = '';
            const firstExperienceItem = document.querySelector('.experience-item');
            if (firstExperienceItem) {
                const jobTitle = firstExperienceItem.querySelector('[id^="jobTitle"]').value;
                const company = firstExperienceItem.querySelector('[id^="company"]').value;
                if (jobTitle && company) {
                    mainExperience = `${jobTitle} na ${company}`;
                }
            }

            if (!name) {
                showMessageModal('Dados Insuficientes', 'Por favor, preencha seu nome para gerar o resumo.', true);
                return;
            }

            const prompt = `Gere um resumo profissional conciso e impactante para um currículo. Considere as seguintes informações:
Nome: ${name}
${mainExperience ? `Experiência principal: ${mainExperience}` : ''}
${skills.trim() ? `Habilidades: ${skills}` : ''}
O resumo deve ter no máximo 500 caracteres, focar em conquistas e objetivos, e ser escrito em primeira pessoa.`;

            const summaryTextarea = document.getElementById('summary');
            const summaryLoading = document.getElementById('summaryLoading');
            await callGeminiAPI(prompt, summaryLoading, summaryTextarea);
        });

        // Função para otimizar a descrição de responsabilidades
        async function optimizeResponsibilities(buttonElement) {
            const experienceItem = buttonElement.closest('.experience-item');
            const responsibilitiesTextarea = experienceItem.querySelector('[id^="responsibilities"]');
            const responsibilityLoading = experienceItem.querySelector('.responsibility-loading');

            const originalText = responsibilitiesTextarea.value;
            if (!originalText.trim()) {
                showMessageModal('Texto Vazio', 'Não há texto para otimizar.', true);
                return;
            }

            const prompt = `Otimize a seguinte descrição de atividades para um currículo, tornando-a mais impactante, usando verbos de ação e, se possível, sugerindo como quantificar resultados (ex: 'Aumentou X%'). Mantenha o texto conciso e em formato de tópicos.
Texto original: ${originalText}`;

            await callGeminiAPI(prompt, responsibilityLoading, responsibilitiesTextarea);
        }


        // Função principal para atualizar a pré-visualização
        function updatePreview() {
            const previewContent = document.getElementById('previewContent');
            let html = '';

            // Dados Pessoais
            const name = document.getElementById('name').value;
            const dob = document.getElementById('dob').value;
            const nationality = document.getElementById('nationality').value;
            const maritalStatus = document.getElementById('maritalStatus').value;
            const addressStreet = document.getElementById('addressStreet').value;
            const addressNumber = document.getElementById('addressNumber').value;
            const addressNeighborhood = document.getElementById('addressNeighborhood').value;
            const addressCEP = document.getElementById('addressCEP').value;
            const addressCity = document.getElementById('addressCity').value;
            const addressUF = document.getElementById('addressUF').value;
            const email = document.getElementById('email').value;
            const portfolio = document.getElementById('portfolio').value;

            if (name) {
                html += `<div class="photo-container">${photoDataUrl ? `<img src="${photoDataUrl}" alt="Foto de Perfil">` : ''}</div>`;
                html += `<h1>${name}</h1>`;
                html += `<p class="contact-info">`;
                const age = calculateAge(dob);
                if (dob || nationality || maritalStatus) {
                    html += `${dob ? formatDisplayDate(dob) + (age ? ` (${age} anos)` : '') : ''}`;
                    html += `${nationality ? ` | ${nationality}` : ''}`;
                    html += `${maritalStatus ? ` | ${maritalStatus}` : ''}<br>`;
                }
                const fullAddress = [addressStreet, addressNumber, addressNeighborhood, addressCity, addressUF].filter(Boolean).join(', ');
                if (fullAddress) {
                    html += `${fullAddress}`;
                    if (addressCEP) html += ` - ${addressCEP}`;
                    html += `<br>`;
                }

                // Telefones
                const phones = [];
                document.querySelectorAll('.phone-item').forEach((item, index) => {
                    const phoneNum = item.querySelector(`[id^="phone"]`).value;
                    const isWhatsapp = item.querySelector(`[id^="whatsapp"]`).checked;
                    if (phoneNum) {
                        phones.push({ number: phoneNum, whatsapp: isWhatsapp });
                    }
                });

                if (phones.length > 0) {
                    phones.forEach((p, index) => {
                        html += `${p.whatsapp ? '<span class="whatsapp-icon"></span>' : ''}${p.number}`;
                        if (index < phones.length - 1) html += ' | ';
                    });
                    html += '<br>';
                }

                html += `${email}<br>`;
                if (portfolio) {
                    html += `<a href="${portfolio}" target="_blank" class="text-blue-600 hover:underline">Portfólio</a>`;
                }
                html += `</p>`;
            }

            // Resumo Profissional
            const summary = document.getElementById('summary').value;
            if (summary) {
                html += `<h2>Resumo Profissional</h2><p>${summary}</p>`;
            }

            // Experiência Profissional
            const experiences = [];
            document.querySelectorAll('.experience-item').forEach(item => {
                const jobTitle = item.querySelector(`[id^="jobTitle"]`).value;
                const company = item.querySelector(`[id^="company"]`).value;
                const startDate = item.querySelector(`[id^="startDate"]`).value;
                const endDate = item.querySelector(`[id^="endDate"]`).value;
                const responsibilities = item.querySelector(`[id^="responsibilities"]`).value;
                if (jobTitle && company && startDate) {
                    experiences.push({ jobTitle, company, startDate, endDate, responsibilities });
                }
            });
            if (experiences.length > 0) {
                html += `<h2>Experiência Profissional</h2>`;
                experiences.forEach(exp => {
                    const endDateText = exp.endDate ? ` - ${exp.endDate}` : ' - Atual';
                    html += `<div class="section-item">`;
                    html += `<p><strong>${exp.jobTitle}</strong> em <strong>${exp.company}</strong></p>`;
                    html += `<p class="text-gray-600 text-sm">${exp.startDate}${endDateText}</p>`;
                    if (exp.responsibilities) { // Responsabilidades agora são opcionais
                        html += `<ul>`;
                        exp.responsibilities.split('\n').forEach(line => {
                            if (line.trim()) html += `<li>${line.trim()}</li>`;
                        });
                        html += `</ul>`;
                    }
                    html += `</div>`;
                });
            }

            // Formação Acadêmica
            const education = [];
            document.querySelectorAll('.education-item').forEach(item => {
                const educationType = item.querySelector(`[id^="educationType"]`).value;
                const institution = item.querySelector(`[id^="institution"]`).value;
                const degree = item.querySelector(`[id^="degree"]`).value;
                const eduStartDate = item.querySelector(`[id^="eduStartDate"]`).value;
                const eduEndDate = item.querySelector(`[id^="eduEndDate"]`).value;
                const eduObservations = item.querySelector(`[id^="eduObservations"]`).value;
                if (educationType) { // Apenas o tipo de ensino é obrigatório para a entrada
                    education.push({ educationType, institution, degree, eduStartDate, eduEndDate, eduObservations });
                }
            });
            if (education.length > 0) {
                html += `<h2>Formação Acadêmica</h2>`;
                education.forEach(edu => {
                    html += `<div class="section-item">`;
                    html += `<p><strong>${edu.educationType}</strong></p>`;
                    let educationDetail = '';
                    if (edu.degree && edu.institution) {
                        educationDetail = `${edu.degree} - ${edu.institution}`;
                    } else if (edu.degree) {
                        educationDetail = `${edu.degree}`;
                    } else if (edu.institution) {
                        educationDetail = `${edu.institution}`;
                    }

                    if (educationDetail) {
                        html += `<p>${educationDetail}</p>`;
                    }

                    const eduPeriod = [edu.eduStartDate, edu.eduEndDate].filter(Boolean).join(' - ');
                    if (eduPeriod) { // Período agora é opcional
                        html += `<p class="text-gray-600 text-sm">${eduPeriod}</p>`;
                    }
                    if (edu.eduObservations) { // Observações agora são opcionais
                        html += `<p class="text-sm"><em>Obs: ${edu.eduObservations}</em></p>`;
                    }
                    html += `</div>`;
                });
            }

            // Certificações e Cursos
            const certifications = [];
            document.querySelectorAll('.certification-item').forEach(item => {
                const certName = item.querySelector(`[id^="certName"]`).value;
                const certInstitution = item.querySelector(`[id^="certInstitution"]`).value;
                const certYear = item.querySelector(`[id^="certYear"]`).value;
                if (certName) {
                    certifications.push({ certName, certInstitution, certYear });
                }
            });
            if (certifications.length > 0) {
                html += `<h2>Certificações e Cursos</h2>`;
                certifications.forEach(cert => {
                    html += `<div class="section-item">`;
                    html += `<p><strong>${cert.certName}</strong>`;
                    if (cert.certInstitution) html += ` - ${cert.certInstitution}`;
                    if (cert.certYear) html += ` (${cert.certYear})`;
                    html += `</p></div>`;
                });
            }

            // Habilidades
            const hardSkills = document.getElementById('hardSkills').value;
            const softSkills = document.getElementById('softSkills').value;
            if (hardSkills || softSkills) {
                html += `<h2>Habilidades</h2>`;
                if (hardSkills) {
                    html += `<p><strong>Hard Skills:</strong> ${hardSkills}</p>`;
                }
                if (softSkills) {
                    html += `<p><strong>Soft Skills:</strong> ${softSkills}</p>`;
                }
            }

            // Idiomas
            const languages = [];
            document.querySelectorAll('.language-item').forEach(item => {
                const langName = item.querySelector(`[id^="langName"]`).value;
                const langFluency = item.querySelector(`[id^="langFluency"]`).value;
                if (langName && langFluency) { // Ambos são obrigatórios para exibir
                    languages.push({ langName, langFluency });
                }
            });
            if (languages.length > 0) {
                html += `<h2>Idiomas</h2>`;
                languages.forEach(lang => {
                    html += `<div class="section-item">`;
                    html += `<p><strong>${lang.langName}</strong> - ${lang.langFluency}</p>`;
                    html += `</div>`;
                });
            }

            // Projetos e Portfólio
            const projects = [];
            document.querySelectorAll('.project-item').forEach(item => {
                const projectName = item.querySelector(`[id^="projectName"]`).value;
                const projectLink = item.querySelector(`[id^="projectLink"]`).value;
                const projectDescription = item.querySelector(`[id^="projectDescription"]`).value;
                if (projectName) {
                    projects.push({ projectName, projectLink, projectDescription });
                }
            });
            if (projects.length > 0) {
                html += `<h2>Projetos e Portfólio</h2>`;
                projects.forEach(proj => {
                    html += `<div class="section-item">`;
                    html += `<p><strong>${proj.projectName}</strong>`;
                    if (proj.projectLink) {
                        html += ` (<a href="${proj.projectLink}" target="_blank" class="text-blue-600 hover:underline">Link</a>)`;
                    }
                    html += `</p>`;
                    if (proj.projectDescription) {
                        html += `<p>${proj.projectDescription}</p>`;
                    }
                    html += `</div>`;
                });
            }

            // Referências
            const references = [];
            document.querySelectorAll('.reference-item').forEach(item => {
                const refName = item.querySelector(`[id^="refName"]`).value;
                const refPosition = item.querySelector(`[id^="refPosition"]`).value;
                const refContact = item.querySelector(`[id^="refContact"]`).value;
                if (refName) {
                    references.push({ refName, refPosition, refContact });
                }
            });
            if (references.length > 0) {
                html += `<h2>Referências</h2>`;
                references.forEach(ref => {
                    html += `<div class="section-item">`;
                    html += `<p><strong>${ref.refName}</strong></p>`;
                    if (ref.refPosition) html += `<p>${ref.refPosition}</p>`;
                    if (ref.refContact) html += `<p>${ref.refContact}</p>`;
                    html += `</div>`;
                });
            }

            previewContent.innerHTML = html || '<p class="text-center text-gray-500 mt-20">Preencha o formulário para ver a pré-visualização do seu currículo.</p>';
        }

        // Event listener para o formulário de currículo (agora só para gerar PDF)
        document.getElementById('resumeForm').addEventListener('submit', async (event) => {
            event.preventDefault(); // Previne o envio padrão do formulário

            try {
                // O conteúdo já está na pré-visualização, vamos usá-la para gerar o PDF
                const previewElement = document.getElementById('previewContent');

                // Garante que o preview esteja visível e com o tamanho correto para o html2canvas
                previewElement.style.width = '210mm'; // Largura A4
                previewElement.style.minHeight = '297mm'; // Altura A4
                previewElement.style.padding = '20px'; // Padding para o PDF

                const canvas = await html2canvas(previewElement, {
                    scale: 2, // Aumenta a escala para melhor qualidade do PDF
                    useCORS: true, // Necessário se houver imagens de outras origens
                    scrollY: -window.scrollY, // Captura a partir do topo da página visível
                    windowWidth: previewElement.scrollWidth,
                    windowHeight: previewElement.scrollHeight,
                });

                const imgData = canvas.toDataURL('image/png');
                const pdf = new jsPDF('p', 'mm', 'a4');
                const imgWidth = 210; // Largura A4 em mm
                const pageHeight = 297; // Altura A4 em mm
                const imgHeight = canvas.height * imgWidth / canvas.width;
                let heightLeft = imgHeight;
                let position = 0;

                pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;

                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }

                generatedPdfBlob = pdf.output('blob');

                // Restaura os estilos do preview se necessário (opcional, pois o CSS já define)
                previewElement.style.width = '210mm'; // Volta ao padrão
                previewElement.style.minHeight = '297mm'; // Volta ao padrão

                document.getElementById('actions').classList.remove('hidden');
                showMessageModal('Currículo Gerado!', 'Seu currículo foi gerado com sucesso. Agora você pode baixá-lo ou enviá-lo para o WhatsApp.', false);

            } catch (error) {
                console.error("Erro ao gerar PDF:", error);
                showMessageModal('Erro!', 'Ocorreu um erro ao gerar o currículo. Por favor, verifique os campos e tente novamente.', true);
            }
        });

        // Event listener para o botão de download
        document.getElementById('downloadPdfBtn').addEventListener('click', () => {
            if (generatedPdfBlob) {
                const url = URL.createObjectURL(generatedPdfBlob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'curriculo.pdf';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            } else {
                showMessageModal('Erro!', 'Nenhum currículo foi gerado ainda. Por favor, preencha o formulário e clique em "Gerar Currículo".', true);
            }
        });

        // Event listener para o botão de enviar para o WhatsApp
        document.getElementById('sendWhatsappBtn').addEventListener('click', () => {
            if (generatedPdfBlob) {
                document.getElementById('whatsappModal').classList.remove('hidden');
            } else {
                showMessageModal('Erro!', 'Nenhum currículo foi gerado ainda. Por favor, preencha o formulário e clique em "Gerar Currículo".', true);
            }
        });

        // Event listeners para o modal do WhatsApp
        document.getElementById('cancelWhatsappBtn').addEventListener('click', () => {
            document.getElementById('whatsappModal').classList.add('hidden');
        });

        document.getElementById('confirmWhatsappBtn').addEventListener('click', () => {
            const whatsappNumber = document.getElementById('whatsappNumberInput').value.replace(/\D/g, ''); // Remove caracteres não numéricos
            if (whatsappNumber) {
                const message = encodeURIComponent("Olá! Estou enviando meu currículo. Por favor, anexe o arquivo PDF que você baixou.");
                const whatsappUrl = `https://wa.me/${whatsappNumber}?text=${message}`;
                window.open(whatsappUrl, '_blank');
                document.getElementById('whatsappModal').classList.add('hidden');
            } else {
                showMessageModal('Número Inválido', 'Por favor, insira um número de WhatsApp válido (apenas números, com DDD e código do país, ex: 5511987654321).', true);
            }
        });

        // Chamada inicial para popular a pré-visualização com dados vazios
        updatePreview();
    </script>
</body>
</html>
