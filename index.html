<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Criador de Currículo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body class="bg-gray-100 font-sans text-gray-800 antialiased p-4 sm:p-6 md:p-8">
    <div class="max-w-4xl mx-auto bg-white p-6 sm:p-8 rounded-lg shadow-xl border border-gray-200">
        <h1 class="text-3xl sm:text-4xl font-bold text-center text-indigo-700 mb-6">Crie Seu Currículo</h1>
        <p class="text-center text-gray-600 mb-8">Preencha os campos abaixo para gerar seu currículo e enviá-lo para o WhatsApp.</p>

        <form id="resumeForm" class="space-y-6">
            <div class="bg-indigo-50 p-4 rounded-lg border border-indigo-200">
                <h2 class="text-2xl font-semibold text-indigo-600 mb-4">1. Dados Pessoais</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="name" class="block text-sm font-medium text-gray-700 mb-1">Nome Completo:</label>
                        <input type="text" id="name" class="w-full p-3 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 ease-in-out" placeholder="Seu nome" required>
                    </div>
                    <div>
                        <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email:</label>
                        <input type="email" id="email" class="w-full p-3 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 ease-in-out" placeholder="seu.email@exemplo.com" required>
                    </div>
                    <div>
                        <label for="phone" class="block text-sm font-medium text-gray-700 mb-1">Telefone (com DDD):</label>
                        <input type="tel" id="phone" class="w-full p-3 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 ease-in-out" placeholder="(XX) XXXXX-XXXX" required>
                    </div>
                    <div>
                        <label for="linkedin" class="block text-sm font-medium text-gray-700 mb-1">LinkedIn (opcional):</label>
                        <input type="url" id="linkedin" class="w-full p-3 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 ease-in-out" placeholder="https://linkedin.com/in/seu-perfil">
                    </div>
                </div>
            </div>

            <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                <h2 class="text-2xl font-semibold text-blue-600 mb-4">2. Resumo Profissional</h2>
                <div>
                    <label for="summary" class="block text-sm font-medium text-gray-700 mb-1">Fale um pouco sobre você e seus objetivos (máx. 300 caracteres):</label>
                    <textarea id="summary" rows="4" class="w-full p-3 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out" placeholder="Ex: Profissional com 5 anos de experiência em marketing digital, buscando uma oportunidade para aplicar habilidades em SEO e mídias sociais..." maxlength="300" required></textarea>
                </div>
            </div>

            <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                <h2 class="text-2xl font-semibold text-green-600 mb-4">3. Experiência Profissional</h2>
                <div id="experienceContainer" class="space-y-4">
                    <div class="experience-item p-3 border border-green-300 rounded-md bg-white">
                        <label for="jobTitle1" class="block text-sm font-medium text-gray-700 mb-1">Cargo:</label>
                        <input type="text" id="jobTitle1" class="w-full p-2 mb-2 border border-gray-300 rounded-md" placeholder="Ex: Analista de Marketing" required>

                        <label for="company1" class="block text-sm font-medium text-gray-700 mb-1">Empresa:</label>
                        <input type="text" id="company1" class="w-full p-2 mb-2 border border-gray-300 rounded-md" placeholder="Ex: Empresa ABC" required>

                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-2">
                            <div>
                                <label for="startDate1" class="block text-sm font-medium text-gray-700 mb-1">Data de Início:</label>
                                <input type="month" id="startDate1" class="w-full p-2 border border-gray-300 rounded-md" required>
                            </div>
                            <div>
                                <label for="endDate1" class="block text-sm font-medium text-gray-700 mb-1">Data de Término (ou "Atual"):</label>
                                <input type="month" id="endDate1" class="w-full p-2 border border-gray-300 rounded-md">
                            </div>
                        </div>
                        <label for="responsibilities1" class="block text-sm font-medium text-gray-700 mb-1">Principais Responsabilidades e Conquistas (use tópicos, máx. 500 caracteres):</label>
                        <textarea id="responsibilities1" rows="3" class="w-full p-2 border border-gray-300 rounded-md" placeholder="- Gerenciamento de campanhas de mídia social&#10;- Aumento de 20% no engajamento..." maxlength="500" required></textarea>
                        <button type="button" class="remove-experience-btn mt-3 px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 transition duration-150 ease-in-out text-sm">Remover</button>
                    </div>
                </div>
                <button type="button" id="addExperienceBtn" class="mt-4 px-5 py-2 bg-green-600 text-white font-semibold rounded-md hover:bg-green-700 transition duration-150 ease-in-out shadow-md">Adicionar Experiência</button>
            </div>

            <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-200">
                <h2 class="text-2xl font-semibold text-yellow-600 mb-4">4. Educação</h2>
                <div id="educationContainer" class="space-y-4">
                    <div class="education-item p-3 border border-yellow-300 rounded-md bg-white">
                        <label for="educationType1" class="block text-sm font-medium text-gray-700 mb-1">Tipo de Ensino:</label>
                        <select id="educationType1" class="w-full p-2 mb-2 border border-gray-300 rounded-md" required>
                            <option value="">Selecione o tipo de ensino</option>
                            <option value="Ensino Fundamental Incompleto">Ensino Fundamental Incompleto</option>
                            <option value="Ensino Fundamental Completo">Ensino Fundamental Completo</option>
                            <option value="Ensino Médio Incompleto">Ensino Médio Incompleto</option>
                            <option value="Ensino Médio Completo">Ensino Médio Completo</option>
                            <option value="Ensino Técnico Incompleto">Ensino Técnico Incompleto</option>
                            <option value="Ensino Técnico Completo">Ensino Técnico Completo</option>
                            <option value="Ensino Superior Incompleto">Ensino Superior Incompleto</option>
                            <option value="Ensino Superior Completo">Ensino Superior Completo</option>
                            <option value="Pós-Graduação Incompleta">Pós-Graduação Incompleta</option>
                            <option value="Pós-Graduação Completa">Pós-Graduação Completa</option>
                            <option value="Mestrado Incompleto">Mestrado Incompleto</option>
                            <option value="Mestrado Completo">Mestrado Completo</option>
                            <option value="Doutorado Incompleto">Doutorado Incompleto</option>
                            <option value="Doutorado Completo">Doutorado Completo</option>
                            <option value="Outro">Outro</option>
                        </select>

                        <label for="degree1" class="block text-sm font-medium text-gray-700 mb-1">Curso/Grau (opcional):</label>
                        <input type="text" id="degree1" class="w-full p-2 mb-2 border border-gray-300 rounded-md" placeholder="Ex: Bacharelado em Ciência da Computação">

                        <label for="institution1" class="block text-sm font-medium text-gray-700 mb-1">Instituição (opcional):</label>
                        <input type="text" id="institution1" class="w-full p-2 mb-2 border border-gray-300 rounded-md" placeholder="Ex: Universidade Federal XYZ">

                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-2">
                            <div>
                                <label for="eduStartDate1" class="block text-sm font-medium text-gray-700 mb-1">Data de Início:</label>
                                <input type="month" id="eduStartDate1" class="w-full p-2 border border-gray-300 rounded-md" required>
                            </div>
                            <div>
                                <label for="eduEndDate1" class="block text-sm font-medium text-gray-700 mb-1">Data de Término (ou "Atual"):</label>
                                <input type="month" id="eduEndDate1" class="w-full p-2 border border-gray-300 rounded-md">
                            </div>
                        </div>
                        <button type="button" class="remove-education-btn mt-3 px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 transition duration-150 ease-in-out text-sm">Remover</button>
                    </div>
                </div>
                <button type="button" id="addEducationBtn" class="mt-4 px-5 py-2 bg-yellow-600 text-white font-semibold rounded-md hover:bg-yellow-700 transition duration-150 ease-in-out shadow-md">Adicionar Educação</button>
            </div>

            <div class="bg-purple-50 p-4 rounded-lg border border-purple-200">
                <h2 class="text-2xl font-semibold text-purple-600 mb-4">5. Habilidades</h2>
                <div>
                    <label for="skills" class="block text-sm font-medium text-gray-700 mb-1">Liste suas habilidades (separadas por vírgula, máx. 300 caracteres):</label>
                    <textarea id="skills" rows="3" class="w-full p-3 border border-gray-300 rounded-md focus:ring-purple-500 focus:border-purple-500 transition duration-150 ease-in-out" placeholder="Ex: Marketing Digital, SEO, Mídias Sociais, Análise de Dados, Comunicação" maxlength="300" required></textarea>
                </div>
            </div>

            <button type="submit" class="w-full py-3 bg-indigo-600 text-white font-bold rounded-md hover:bg-indigo-700 transition duration-200 ease-in-out shadow-lg">Gerar Currículo</button>
        </form>

        <div id="actions" class="mt-8 pt-6 border-t border-gray-200 hidden">
            <h2 class="text-2xl font-semibold text-gray-700 mb-4 text-center">Seu currículo está pronto!</h2>
            <div class="flex flex-col sm:flex-row justify-center gap-4">
                <button id="downloadPdfBtn" class="flex-1 px-6 py-3 bg-blue-600 text-white font-bold rounded-md hover:bg-blue-700 transition duration-200 ease-in-out shadow-md">
                    Baixar Currículo (PDF)
                </button>
                <button id="sendWhatsappBtn" class="flex-1 px-6 py-3 bg-green-500 text-white font-bold rounded-md hover:bg-green-600 transition duration-200 ease-in-out shadow-md">
                    Enviar para o WhatsApp
                </button>
            </div>
            <p class="text-center text-sm text-gray-500 mt-4">
                Ao clicar em "Enviar para o WhatsApp", você será direcionado para o aplicativo. Lembre-se de anexar o arquivo PDF que você baixou.
            </p>
        </div>

        <div id="whatsappModal" class="fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center hidden">
            <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-sm">
                <h3 class="text-xl font-semibold mb-4">Seu número de WhatsApp</h3>
                <p class="text-gray-700 mb-4">Por favor, insira o número de WhatsApp (com DDD) para o qual você deseja enviar o currículo.</p>
                <input type="tel" id="whatsappNumberInput" class="w-full p-3 border border-gray-300 rounded-md mb-4" placeholder="Ex: 5511987654321" required>
                <div class="flex justify-end space-x-3">
                    <button id="cancelWhatsappBtn" class="px-4 py-2 bg-gray-300 text-gray-800 rounded-md hover:bg-gray-400">Cancelar</button>
                    <button id="confirmWhatsappBtn" class="px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600">Confirmar</button>
                </div>
            </div>
        </div>

        <div id="messageModal" class="fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center hidden">
            <div class="bg-white p-6 rounded-lg shadow-xl w-full max-w-sm">
                <h3 id="messageModalTitle" class="text-xl font-semibold mb-4 text-red-600"></h3>
                <p id="messageModalContent" class="text-gray-700 mb-4"></p>
                <div class="flex justify-end">
                    <button id="closeMessageModalBtn" class="px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600">Ok</button>
                </div>
            </div>
        </div>

    </div>

    <script>
        // Inicializa jsPDF
        const { jsPDF } = window.jspdf;

        let generatedPdfBlob = null; // Para armazenar o PDF gerado temporariamente

        // Funções para adicionar/remover campos de experiência e educação
        let experienceCount = 1;
        document.getElementById('addExperienceBtn').addEventListener('click', () => {
            experienceCount++;
            const container = document.getElementById('experienceContainer');
            const newItem = document.createElement('div');
            newItem.classList.add('experience-item', 'p-3', 'border', 'border-green-300', 'rounded-md', 'bg-white');
            newItem.innerHTML = `
                <label for="jobTitle${experienceCount}" class="block text-sm font-medium text-gray-700 mb-1">Cargo:</label>
                <input type="text" id="jobTitle${experienceCount}" class="w-full p-2 mb-2 border border-gray-300 rounded-md" placeholder="Ex: Analista de Marketing" required>

                <label for="company${experienceCount}" class="block text-sm font-medium text-gray-700 mb-1">Empresa:</label>
                <input type="text" id="company${experienceCount}" class="w-full p-2 mb-2 border border-gray-300 rounded-md" placeholder="Ex: Empresa ABC" required>

                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-2">
                    <div>
                        <label for="startDate${experienceCount}" class="block text-sm font-medium text-gray-700 mb-1">Data de Início:</label>
                        <input type="month" id="startDate${experienceCount}" class="w-full p-2 border border-gray-300 rounded-md" required>
                    </div>
                    <div>
                        <label for="endDate${experienceCount}" class="block text-sm font-medium text-gray-700 mb-1">Data de Término (ou "Atual"):</label>
                        <input type="month" id="endDate${experienceCount}" class="w-full p-2 border border-gray-300 rounded-md">
                    </div>
                </div>
                <label for="responsibilities${experienceCount}" class="block text-sm font-medium text-gray-700 mb-1">Principais Responsabilidades e Conquistas (use tópicos, máx. 500 caracteres):</label>
                <textarea id="responsibilities${experienceCount}" rows="3" class="w-full p-2 border border-gray-300 rounded-md" placeholder="- Gerenciamento de campanhas de mídia social&#10;- Aumento de 20% no engajamento..." maxlength="500" required></textarea>
                <button type="button" class="remove-experience-btn mt-3 px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 transition duration-150 ease-in-out text-sm">Remover</button>
            `;
            container.appendChild(newItem);
            addRemoveExperienceListeners();
        });

        function addRemoveExperienceListeners() {
            document.querySelectorAll('.remove-experience-btn').forEach(button => {
                button.onclick = (event) => {
                    event.target.closest('.experience-item').remove();
                };
            });
        }
        addRemoveExperienceListeners(); // Adiciona listeners para o item inicial

        let educationCount = 1;
        document.getElementById('addEducationBtn').addEventListener('click', () => {
            educationCount++;
            const container = document.getElementById('educationContainer');
            const newItem = document.createElement('div');
            newItem.classList.add('education-item', 'p-3', 'border', 'border-yellow-300', 'rounded-md', 'bg-white');
            newItem.innerHTML = `
                <label for="educationType${educationCount}" class="block text-sm font-medium text-gray-700 mb-1">Tipo de Ensino:</label>
                <select id="educationType${educationCount}" class="w-full p-2 mb-2 border border-gray-300 rounded-md" required>
                    <option value="">Selecione o tipo de ensino</option>
                    <option value="Ensino Fundamental Incompleto">Ensino Fundamental Incompleto</option>
                    <option value="Ensino Fundamental Completo">Ensino Fundamental Completo</option>
                    <option value="Ensino Médio Incompleto">Ensino Médio Incompleto</option>
                    <option value="Ensino Médio Completo">Ensino Médio Completo</option>
                    <option value="Ensino Técnico Incompleto">Ensino Técnico Incompleto</option>
                    <option value="Ensino Técnico Completo">Ensino Técnico Completo</option>
                    <option value="Ensino Superior Incompleto">Ensino Superior Incompleto</option>
                    <option value="Ensino Superior Completo">Ensino Superior Completo</option>
                    <option value="Pós-Graduação Incompleta">Pós-Graduação Incompleta</option>
                    <option value="Pós-Graduação Completa">Pós-Graduação Completa</option>
                    <option value="Mestrado Incompleto">Mestrado Incompleto</option>
                    <option value="Mestrado Completo">Mestrado Completo</option>
                    <option value="Doutorado Incompleto">Doutorado Incompleto</option>
                    <option value="Doutorado Completo">Doutorado Completo</option>
                    <option value="Outro">Outro</option>
                </select>

                <label for="degree${educationCount}" class="block text-sm font-medium text-gray-700 mb-1">Curso/Grau (opcional):</label>
                <input type="text" id="degree${educationCount}" class="w-full p-2 mb-2 border border-gray-300 rounded-md" placeholder="Ex: Bacharelado em Ciência da Computação">

                <label for="institution${educationCount}" class="block text-sm font-medium text-gray-700 mb-1">Instituição (opcional):</label>
                <input type="text" id="institution${educationCount}" class="w-full p-2 mb-2 border border-gray-300 rounded-md" placeholder="Ex: Universidade Federal XYZ">

                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-2">
                    <div>
                        <label for="eduStartDate${educationCount}" class="block text-sm font-medium text-gray-700 mb-1">Data de Início:</label>
                        <input type="month" id="eduStartDate${educationCount}" class="w-full p-2 border border-gray-300 rounded-md" required>
                    </div>
                    <div>
                        <label for="eduEndDate${educationCount}" class="block text-sm font-medium text-gray-700 mb-1">Data de Término (ou "Atual"):</label>
                        <input type="month" id="eduEndDate${educationCount}" class="w-full p-2 border border-gray-300 rounded-md">
                    </div>
                </div>
                <button type="button" class="remove-education-btn mt-3 px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600 transition duration-150 ease-in-out text-sm">Remover</button>
            `;
            container.appendChild(newItem);
            addRemoveEducationListeners();
        });

        function addRemoveEducationListeners() {
            document.querySelectorAll('.remove-education-btn').forEach(button => {
                button.onclick = (event) => {
                    event.target.closest('.education-item').remove();
                };
            });
        }
        addRemoveEducationListeners(); // Adiciona listeners para o item inicial

        // Função para exibir o modal de mensagem
        function showMessageModal(title, content, isError = false) {
            const modal = document.getElementById('messageModal');
            document.getElementById('messageModalTitle').textContent = title;
            document.getElementById('messageModalContent').textContent = content;
            document.getElementById('messageModalTitle').classList.toggle('text-red-600', isError);
            document.getElementById('messageModalTitle').classList.toggle('text-green-600', !isError);
            modal.classList.remove('hidden');
        }

        // Event listener para fechar o modal de mensagem
        document.getElementById('closeMessageModalBtn').addEventListener('click', () => {
            document.getElementById('messageModal').classList.add('hidden');
        });

        // Event listener para o formulário de currículo
        document.getElementById('resumeForm').addEventListener('submit', async (event) => {
            event.preventDefault(); // Previne o envio padrão do formulário

            try {
                // Coleta os dados do formulário
                const name = document.getElementById('name').value;
                const email = document.getElementById('email').value;
                const phone = document.getElementById('phone').value;
                const linkedin = document.getElementById('linkedin').value;
                const summary = document.getElementById('summary').value;
                const skills = document.getElementById('skills').value.split(',').map(s => s.trim()).filter(s => s);

                const experiences = [];
                document.querySelectorAll('.experience-item').forEach((item, index) => {
                    const jobTitle = item.querySelector(`[id^="jobTitle"]`).value;
                    const company = item.querySelector(`[id^="company"]`).value;
                    const startDate = item.querySelector(`[id^="startDate"]`).value;
                    const endDate = item.querySelector(`[id^="endDate"]`).value;
                    const responsibilities = item.querySelector(`[id^="responsibilities"]`).value;
                    if (jobTitle && company && startDate && responsibilities) {
                        experiences.push({ jobTitle, company, startDate, endDate, responsibilities });
                    }
                });

                const education = [];
                document.querySelectorAll('.education-item').forEach((item, index) => {
                    const educationType = item.querySelector(`[id^="educationType"]`).value; // Novo campo
                    const degree = item.querySelector(`[id^="degree"]`).value;
                    const institution = item.querySelector(`[id^="institution"]`).value;
                    const eduStartDate = item.querySelector(`[id^="eduStartDate"]`).value;
                    const eduEndDate = item.querySelector(`[id^="eduEndDate"]`).value;
                    if (educationType && eduStartDate) { // 'educationType' e 'eduStartDate' são obrigatórios
                        education.push({ educationType, degree, institution, eduStartDate, eduEndDate });
                    }
                });

                // Cria um novo documento jsPDF
                const doc = new jsPDF();
                let y = 20; // Posição Y inicial

                // Título do Currículo
                doc.setFontSize(24);
                doc.setTextColor(51, 51, 153); // Azul escuro
                doc.text(name, 105, y, { align: 'center' });
                y += 10;

                // Informações de Contato
                doc.setFontSize(10);
                doc.setTextColor(102, 102, 102); // Cinza
                doc.text(`${email} | ${phone}`, 105, y, { align: 'center' });
                y += 5;
                if (linkedin) {
                    doc.text(`LinkedIn: ${linkedin}`, 105, y, { align: 'center' });
                    y += 5;
                }
                y += 10;

                // Resumo Profissional
                doc.setFontSize(16);
                doc.setTextColor(51, 51, 51); // Preto
                doc.text('Resumo Profissional', 20, y);
                doc.setDrawColor(200, 200, 200); // Cinza claro
                doc.line(20, y + 2, 190, y + 2); // Linha separadora
                y += 10;
                doc.setFontSize(12);
                doc.setTextColor(0, 0, 0); // Preto
                const splitSummary = doc.splitTextToSize(summary, 170);
                doc.text(splitSummary, 20, y);
                y += (splitSummary.length * 7) + 5; // Ajusta Y para o próximo bloco

                // Experiência Profissional
                if (experiences.length > 0) {
                    doc.setFontSize(16);
                    doc.setTextColor(51, 51, 51);
                    doc.text('Experiência Profissional', 20, y);
                    doc.setDrawColor(200, 200, 200);
                    doc.line(20, y + 2, 190, y + 2);
                    y += 10;

                    experiences.forEach(exp => {
                        doc.setFontSize(12);
                        doc.setTextColor(0, 0, 0);
                        doc.text(`${exp.jobTitle} em ${exp.company}`, 20, y);
                        y += 6;
                        doc.setFontSize(10);
                        doc.setTextColor(102, 102, 102);
                        const endDateText = exp.endDate ? ` - ${exp.endDate}` : ' - Atual';
                        doc.text(`${exp.startDate}${endDateText}`, 20, y);
                        y += 6;
                        doc.setFontSize(11);
                        doc.setTextColor(0, 0, 0);
                        const splitResponsibilities = doc.splitTextToSize(exp.responsibilities, 170);
                        splitResponsibilities.forEach(line => {
                            doc.text(`• ${line}`, 25, y); // Adiciona um marcador de lista
                            y += 6;
                        });
                        y += 5; // Espaço entre experiências
                        if (y > 280) { // Se estiver perto do final da página, adiciona nova página
                            doc.addPage();
                            y = 20;
                        }
                    });
                }

                // Educação
                if (education.length > 0) {
                    doc.setFontSize(16);
                    doc.setTextColor(51, 51, 51);
                    doc.text('Educação', 20, y);
                    doc.setDrawColor(200, 200, 200);
                    doc.line(20, y + 2, 190, y + 2);
                    y += 10;

                    education.forEach(edu => {
                        doc.setFontSize(12);
                        doc.setTextColor(0, 0, 0);
                        doc.text(`${edu.educationType}`, 20, y); // Adiciona o tipo de ensino
                        y += 6;

                        let educationDetail = '';
                        if (edu.degree && edu.institution) {
                            educationDetail = `${edu.degree} - ${edu.institution}`;
                        } else if (edu.degree) {
                            educationDetail = `${edu.degree}`;
                        } else if (edu.institution) {
                            educationDetail = `${edu.institution}`;
                        }

                        if (educationDetail) {
                            doc.setFontSize(11);
                            doc.text(educationDetail, 20, y);
                            y += 6;
                        }

                        doc.setFontSize(10);
                        doc.setTextColor(102, 102, 102);
                        const eduEndDateText = edu.eduEndDate ? ` - ${edu.eduEndDate}` : ' - Atual';
                        doc.text(`${edu.eduStartDate}${eduEndDateText}`, 20, y);
                        y += 10;
                        if (y > 280) { // Se estiver perto do final da página, adiciona nova página
                            doc.addPage();
                            y = 20;
                        }
                    });
                }

                // Habilidades
                if (skills.length > 0) {
                    doc.setFontSize(16);
                    doc.setTextColor(51, 51, 51);
                    doc.text('Habilidades', 20, y);
                    doc.setDrawColor(200, 200, 200);
                    doc.line(20, y + 2, 190, y + 2);
                    y += 10;
                    doc.setFontSize(12);
                    doc.setTextColor(0, 0, 0);
                    const skillsText = skills.join(', ');
                    const splitSkills = doc.splitTextToSize(skillsText, 170);
                    doc.text(splitSkills, 20, y);
                    y += (splitSkills.length * 7) + 5;
                }

                // Armazena o PDF como Blob para download e envio
                generatedPdfBlob = doc.output('blob');

                // Exibe os botões de ação
                document.getElementById('actions').classList.remove('hidden');
                showMessageModal('Currículo Gerado!', 'Seu currículo foi gerado com sucesso. Agora você pode baixá-lo ou enviá-lo para o WhatsApp.', false);

            } catch (error) {
                console.error("Erro ao gerar PDF:", error);
                showMessageModal('Erro!', 'Ocorreu um erro ao gerar o currículo. Por favor, verifique os campos e tente novamente.', true);
            }
        });

        // Event listener para o botão de download
        document.getElementById('downloadPdfBtn').addEventListener('click', () => {
            if (generatedPdfBlob) {
                const url = URL.createObjectURL(generatedPdfBlob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'curriculo.pdf';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            } else {
                showMessageModal('Erro!', 'Nenhum currículo foi gerado ainda. Por favor, preencha o formulário e clique em "Gerar Currículo".', true);
            }
        });

        // Event listener para o botão de enviar para o WhatsApp
        document.getElementById('sendWhatsappBtn').addEventListener('click', () => {
            if (generatedPdfBlob) {
                document.getElementById('whatsappModal').classList.remove('hidden');
            } else {
                showMessageModal('Erro!', 'Nenhum currículo foi gerado ainda. Por favor, preencha o formulário e clique em "Gerar Currículo".', true);
            }
        });

        // Event listeners para o modal do WhatsApp
        document.getElementById('cancelWhatsappBtn').addEventListener('click', () => {
            document.getElementById('whatsappModal').classList.add('hidden');
        });

        document.getElementById('confirmWhatsappBtn').addEventListener('click', () => {
            const whatsappNumber = document.getElementById('whatsappNumberInput').value.replace(/\D/g, ''); // Remove caracteres não numéricos
            if (whatsappNumber) {
                const message = encodeURIComponent("Olá! Estou enviando meu currículo. Por favor, anexe o arquivo PDF que você baixou.");
                const whatsappUrl = `https://wa.me/${whatsappNumber}?text=${message}`;
                window.open(whatsappUrl, '_blank');
                document.getElementById('whatsappModal').classList.add('hidden');
            } else {
                showMessageModal('Número Inválido', 'Por favor, insira um número de WhatsApp válido (apenas números, com DDD e código do país, ex: 5511987654321).', true);
            }
        });
    </script>
</body>
</html>
